# ç½‘ç»œå®‰å…¨ æ‹¼å®¢å­¦é™¢-é™ˆé‘«æ° 2017.9.22

[TOC]













# Â§0 è¯„ä»·

ç›´æ’­è¯¾ï¼Œæœ‰äº’åŠ¨ï¼Œæœ‰è¯´æœ‰ç¬‘ï¼Œkkskã€‚

# Â§1 ç½‘ç»œå®‰å…¨ç®€ä»‹

## Â§1.1 ç½‘ç»œå®‰å…¨å…¥é—¨å¯¼è®º

```mermaid
graph LR
	A(å®‰å…¨ä¼ä¸š) <-- å¯¹æŠ— --> B(ç½‘ç»œçŠ¯ç½ª)
	B --æ”»å‡» çªƒå–--> C(æ”¿åºœ ä¼ä¸š æ°‘ä¼—)
	A --ä¿æŠ¤--> C
```

<a style="color:red">æ³¨æ„ä»‹ç»çš„ä¼ä¸šæ‹›è˜å²—ä½ã€è¦æ±‚ï¼</a>

## Â§1.2 åŸºæœ¬æŠ€èƒ½

- æŒæ¡å„ç±»ç½‘ç»œåè®®çš„åŸç†ä¸å®è·µï¼š

  - TCP/IP
  - VLAN/Trunk/MSTP/VRRP/802.1X
  - OSPF/BGP/MPLS
  - IPsec/SSL

- æŒæ¡ä¸»æµç½‘ç»œå’Œå®‰å…¨å·¥å…·çš„ä½¿ç”¨

  - GNS3/Cisco PT/eNSP/SecureCRT/Wireshark/Solorwinds

- æŒæ¡ä¸»æµç½‘ç»œä¸å®‰å…¨è®¾å¤‡çš„å‘½ä»¤è°ƒè¯•ä¸æ•…éšœæ’æŸ¥

  - æ€ç§‘/åä¸º/åä¸‰/é”æ·/Juniper/é£å¡”/ç»¿ç›Ÿ/æ·±ä¿¡æœ/å¤©èä¿¡
  - è·¯ç”±å™¨/äº¤æ¢æœº/é˜²ç«å¢™/IDS/IPS/AC/AD/VPN

- æŒæ¡ç½‘ç»œå®‰å…¨æ¶æ„ä¸è®¾è®¡

  - ä¼ä¸šç½‘/æ”¿åŠ¡ç½‘/æ•™è‚²ç½‘/æ•°æ®ä¸­å¿ƒç½‘è®¾è®¡ä¸éƒ¨ç½²

## Â§1.3 æ¨èä¹¦å•

  ã€ŠCCNAå­¦ä¹ æŒ‡å—ã€‹ã€ŠTCP/IPè¯¦è§£å·ä¸€ã€‹ã€Šå±€åŸŸç½‘äº¤æ¢æœºå®‰å…¨ã€‹ã€ŠCiscoé˜²ç«å¢™ã€‹ã€Šç½‘ç»œå®‰å…¨åŸç†ä¸å®è·µã€‹ã€Šç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è§£å†³æ–¹æ¡ˆã€‹ã€Šåä¸ºé˜²ç«å¢™æŠ€æœ¯æ¼«è°ˆã€‹ã€ŠCiscoç½‘ç»œé»‘å®¢å¤§æ›å…‰ã€‹ã€ŠWiresharkç½‘ç»œåˆ†æå®æˆ˜ã€‹ã€ŠWiresharkæ•°æ®åŒ…åˆ†æå®æˆ˜ã€‹ã€ŠDDosæ”»å‡»ä¸é˜²èŒƒæ·±åº¦å‰–æã€‹ã€ŠCisco VPNå®Œå…¨é…ç½®æŒ‡å—ã€‹ã€ŠCiscoå®‰å…¨å…¥ä¾µæ£€æµ‹ç³»ç»Ÿã€‹ã€Šè®¡ç®—æœºç½‘ç»œå®è·µæ•™ç¨‹-åŸºäºGNS3ç½‘ç»œæ¨¡æ‹Ÿå™¨ã€‹ã€Šäº’è”ç½‘ä¼ä¸šå®‰å…¨é«˜çº§æŒ‡å—ã€‹

## Â§1.4 å®‰å…¨å·¥å…·

- GNS3
- Cisco PT
- eNSP
- SecureCRT
- Wireshark
- Nmap
- Vmware
-  Visio
- Cain
- Ettercap
- Hping3

<img src="ç½‘ç»œå®‰å…¨/image-20210701135710934.png" alt="image-20210701135710934" style="zoom:80%;" />

![image-20210706190336416](ç½‘ç»œå®‰å…¨/image-20210706190336416.png)

## Â§1.5 å­¦ä¹ æ–¹æ³•

- å…ˆç½‘ç»œåå®‰å…¨
- å‹¤åšå®éªŒå‹¤æŠ“åŒ…
- å•ç‚¹çªç ´æ¨ªå‘æ‹“å±•
- ä»å·¥ç¨‹å®æ–½åˆ°æ–¹æ¡ˆè®¾è®¡

![image-20210701140543967](ç½‘ç»œå®‰å…¨/image-20210701140543967-1625119548284.png)

![image-20210701140644675](ç½‘ç»œå®‰å…¨/image-20210701140644675-1625119606609.png)

![image-20210701140950011](ç½‘ç»œå®‰å…¨/image-20210701140950011-1625119792040.png)

# Â§2 è®¡ç®—æœºç½‘ç»œ

## Â§2.1 Ethernetåè®®

ç”¨äºå®ç°é“¾è·¯å±‚æ•°æ®ä¼ è¾“å’Œåœ°å€å°è£…ã€‚

```wireshark
Ethernet II, Src: RuijieNe_91:13:ba (58:69:6c:91:13:ba), Dst: IntelCor_2b:78:f7 (dc:1b:a1:2b:78:f7)
    Destination: IntelCor_2b:78:f7 (dc:1b:a1:2b:78:f7)
        Address: IntelCor_2b:78:f7 (dc:1b:a1:2b:78:f7)
        .... ..0. .... .... .... .... = LG bit: Globally unique address (factory default)
        .... ...0 .... .... .... .... = IG bit: Individual address (unicast)
    Source: RuijieNe_91:13:ba (58:69:6c:91:13:ba)
        Address: RuijieNe_91:13:ba (58:69:6c:91:13:ba)
        .... ..0. .... .... .... .... = LG bit: Globally unique address (factory default)
        .... ...0 .... .... .... .... = IG bit: Individual address (unicast)
    Type: IPv4 (0x0800)
```

## Â§2.2 IPåè®®

```wireshark
Internet Protocol Version 4, Src: 183.134.40.170, Dst: 10.5.177.40
    0100 .... = Version: 4
    .... 0101 = Header Length: 20 bytes (5)
    Differentiated Services Field: 0x00 (DSCP: CS0, ECN: Not-ECT)
        0000 00.. = Differentiated Services Codepoint: Default (0)
        .... ..00 = Explicit Congestion Notification: Not ECN-Capable Transport (0)
    Total Length: 1500
    Identification: 0x5b8d (23437)
    Flags: 0x4000, Don't fragment
        0... .... .... .... = Reserved bit: Not set
        .1.. .... .... .... = Don't fragment: Set
        ..0. .... .... .... = More fragments: Not set
    Fragment offset: 0
    Time to live: 43
    Protocol: TCP (6)
    Header checksum: 0x5331 [validation disabled]
    [Header checksum status: Unverified]
    Source: 183.134.40.170
    Destination: 10.5.177.40
```

- `Version`ï¼šç‰ˆæœ¬å·ï¼Œæ ‡è¯†IPåè®®çš„ç‰ˆæœ¬

  > 0100ï¼šåŒ–ä¸ºåè¿›åˆ¶ä¸º4ï¼Œä»£è¡¨IPv4

- `Header Length`ï¼šå¤´éƒ¨é•¿åº¦ï¼Œä»£è¡¨æ•´ä¸ªIPåè®®æ•°æ®åŒ…ä¸­ï¼Œé™¤äº†æ•°æ®ä»¥å¤–æ‰€å çš„è¡Œæ•°ï¼Œæ¯ä¸€è¡Œæœ‰4ä¸ªbyte

  > 0101ï¼šé»˜è®¤ä¸º5ï¼Œè¡¨ç¤ºå…±æœ‰$5è¡ŒÃ—4\text{bit/è¡Œ}=20$ä¸ªbyteï¼Œç›¸å½“äº$20Ã—8=160$ä¸ªbit
  >
  > æœ€å¤§ä¸º60byteï¼Œæ­¤æ—¶è¶…å‡º20ä¸ªbyteçš„éƒ¨åˆ†ç§°ä¸ºdata

- `Differentiated Services Filed`ï¼šæœåŠ¡åŒºåˆ†ç¬¦ï¼Œä¸ºä¸åŒçš„æ•°æ®åŒ…å®šä¹‰ä¸åŒçš„æœåŠ¡è´¨é‡ï¼Œå¸¸ç”¨äºQoS

- `Total Length`ï¼šæ€»é•¿åº¦ï¼Œè¡¨ç¤ºä¸Šä¸€å±‚è¢«å°è£…çš„æ€»æ•°æ®é•¿åº¦ï¼Œæœ€å¤§ä¸º65536å­—èŠ‚

- `Identification`ï¼šæ ‡è¯†ç¬¦ï¼Œç”¨æ¥å®ç°IPåˆ†ç‰‡çš„å……è¶³ï¼Œæ ‡è¯†åˆ†ç‰‡å±äºå“ªä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹é€šè¿‡idåŒºåˆ†

- <span name="1">`Flags`</span>ï¼šæ ‡å¿—ç¬¦ï¼Œç”¨äºç¡®è®¤æ˜¯å¦è¿˜æœ‰IPåˆ†ç‰‡ï¼Œæˆ–è€…èƒ½å¦æ‰§è¡Œåˆ†ç‰‡

- `Fragment offset`ï¼šåˆ†ç‰‡åç§»é‡ï¼Œæ ‡è¯†IPåˆ†ç‰‡çš„åºå·ï¼Œä»è€Œå®ç°IPåˆ†ç‰‡çš„é‡ç»„

- `Time to live`ï¼šç”Ÿå­˜æ—¶é—´ï¼Œè¡¨ç¤ºæ•°æ®åŒ…è¿˜èƒ½ç”Ÿå­˜å¤šä¹…ï¼Œæ²¡ç»è¿‡ä¸€ä¸ªä¸‰å±‚è®¾å¤‡ï¼ˆå¦‚è·¯ç”±å™¨ï¼‰åˆ™å‡1ï¼Œå€¼ä¸º0æ—¶è¢«æŠ›å¼ƒ

- `Protocol`ï¼šåè®®å·ï¼Œè¡¨ç¤ºIPåè®®ä¸Šå±‚åº”ç”¨

  > 00000001ï¼š1ï¼Œä»£è¡¨ICMPåè®®å·
  >
  > 00000110ï¼š6ï¼Œä»£è¡¨TCPåè®®å·
  >
  > 00010001ï¼š17ï¼Œä»£è¡¨UDPåè®®å·

- `Header checksum`ï¼šå¤´éƒ¨æ ¡éªŒï¼Œè‹¥æ•°æ®åŒ…ä¸å®Œæ•´æˆ–è¢«ä¿®æ”¹åˆ™è¢«ç›´æ¥ä¸¢å¼ƒ

  > å°†æ•´ä¸ªIPåè®®ä¸­é™¤äº†`Header checksum`éƒ¨åˆ†ä»¥å¤–çš„æ‰€æœ‰åŒåå…­è¿›åˆ¶æ•°å­—ç›¸åŠ ï¼Œå°†å…¶æ‹†ä¸ºåƒåˆ†ä½ä»¥ä¸‹å’Œåƒåˆ†ä½ä»¥ä¸Šä¸¤ä¸ªæ•°å­—ï¼Œç›¸åŠ å¾—åˆ°åƒä½æ•°å­—ï¼Œå–å…¶åç ä½œä¸º`Header checksum`
  >
  > ä¾‹å¦‚ï¼š01000101 00000000 00000000 00101000 01010001 11010010 01000000 00000000 10000000 00000110 **11111010 01100111** 00001010 00000101 10110001 00101000 01101111 11001110 11010010 01001011
  >
  > é™¤å»**00000000 00000000**ä»¥å¤–çš„æ‰€æœ‰å…«ä½äºŒè¿›åˆ¶æ•°å­—ç›¸åŠ ï¼Œå¾—åˆ°00000101 10011000~(2)~ï¼Œå–åç å¾—åˆ°11111010 01100111~(2)~ï¼Œå³0xF167

- `Source`ï¼šæºIPåœ°å€

  > å…±32bitï¼Œå¯¹åº”4ä¸ª0~255çš„ç‚¹åˆ†åè¿›åˆ¶æ•°å­—

- `Destination`ï¼šç›®çš„IPåœ°å€

  > å…±32bitï¼Œå¯¹åº”4ä¸ª0~255çš„ç‚¹åˆ†åè¿›åˆ¶æ•°å­—

$$
\begin{cases}
\text{ID}+\text{Flags}+\text{Fragment offset}:å®ç°\text{IP}æ•°æ®åˆ†ç‰‡å’Œé‡ç»„\\
\text{TTL}:å®ç°é€šä¿¡é˜²ç¯\\
\text{DSCP}:å®ç°æµé‡æ§åˆ¶\\
\text{Protocal}:æ ‡è®°ä¸Šå±‚åº”ç”¨
\end{cases}
$$

## Â§2.3 TCPåè®®

- é¢å‘è¿æ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹ï¼‰
- å¯é ä¼ è¾“ï¼ˆç»å…¸é‡ä¼ ã€è¶…æ—¶é‡ä¼ ã€å¿«é€Ÿé‡ä¼ /é€‰æ‹©æ€§é‡ä¼ ï¼‰
- æµé‡æ§åˆ¶ï¼ˆæ»‘åŠ¨çª—å£ã€æ‹¥å¡ç®¡ç†ï¼‰
- å¤šè·¯å¤ç”¨ï¼ˆå¥—æ¥å­—ï¼‰

`SYN`(Synchronous)å’Œ`ACK`(Acknowledgement)ç”±TCPåè®®ä¸­çš„<a href="#1">Flags</a>å­—æ®µä¸­çš„ä¸€éƒ¨åˆ†æ¥ç¡®å®š.

```
//å»ºç«‹è¿æ¥çš„ä¸‰æ¬¡æ¡æ‰‹
PC<100>â†’Server<80> æ•°æ®åŒ…1 TCP:SYN<80>ï¼Œè¯·æ±‚è®¿é—®
Server<80>â†’PC<100> æ•°æ®åŒ…2 TCP:ACK/SYN<100>ï¼Œå…è®¸è®¿é—®
PC<100>â†’Server<80> æ•°æ®åŒ…3 TCP:ACKï¼Œç¡®è®¤å…è®¸è®¿é—®

//ä½¿ç”¨è¿æ¥
PC<100>â†’Server<80> æ•°æ®åŒ… HTTP/GET/POST/....

//æ–­å¼€è¿æ¥çš„å››æ¬¡æŒ¥æ‰‹
PC<100>â†’Server<80> æ•°æ®åŒ…1 TCP:FIN
Server<80>â†’PC<100> æ•°æ®åŒ…2 TCP:ACK
Server<80>â†’PC<100> æ•°æ®åŒ…2 TCP:FIN
PC<100>â†’Server<80> æ•°æ®åŒ…1 TCP:ACK
```

## Â§2.4 ARPåè®®

å°†ipæ¯”ä½œæ”¶ä»¶äººå§“åï¼Œå°†MACæ¯”ä½œæ”¶ä»¶äººåœ°å€ï¼Œç¬¬ä¸€ä¸ªæ•°æ®åŒ…ä¸­å«æœ‰PC1çš„ipï¼ŒPC1çš„MACï¼ŒPC2çš„MACåœ°å€ï¼Œæ²¡æœ‰PC2çš„MACåœ°å€ï¼Œæ‰€ä»¥æ— æ³•å‘å‡ºã€‚

```
//ARPè¯·æ±‚åŒ…
PC1â†’PC2 ARP Request

//ARPå›åº”åŒ…
PC2â†’PC1 ARP Reply
```

å‘ç¬¬äºŒä¸ªåŒ…ä¹‹å‰ï¼Œç³»ç»Ÿå·²ç»å—åˆ°äº†ARPå›åº”åŒ…ï¼Œæ‰€ä»¥å¯ä»¥å‘å‡ºã€‚

# Â§3ç½‘ç»œæ”»å‡»

## Â§3.1 ARPæ”»å‡»

```mermaid
graph TB
	A(PC1)-->B((SW1))
	C(PC_hacker)-->B
	D(PC2)-->B
```

å½“PC1å‘å‡º`ARP Request`æ—¶ï¼Œé»‘å®¢æœºå’ŒPC2åŒæ—¶å‘å‡º`ARP Response`ï¼ŒPC1æœ€ç»ˆé€‰æ‹©æœ€å…ˆæ”¶åˆ°çš„æ•°æ®åŒ…ã€‚ä¸ºç¡®ä¿æ¬ºéª—æˆåŠŸï¼ŒPC_hackerä½¿ç”¨ä¸“ä¸šçš„å®‰å…¨å·¥å…·é«˜å¼ºåº¦å‘é€æ•°æ®åŒ…ï¼Œæœ€ç»ˆå°†PC1ä¸­çš„PC2ç‰©ç†åœ°å€é¡¶æ›¿æ‰ã€‚

### Â§3.1.1 P2Pç»ˆç»“è€…/Ettercap/Cain & Abel

telnet route-server.ip.att.net

Flow TCP Stream -- Wireshark

### Â§3.1.2 ARPé˜²å¾¡

æœ‰ä¸¤ç‚¹å¯ä»¥é˜²å¾¡ï¼š

- ä¿è¯PCä¸æ”¶åˆ°ARPæ¬ºéª—åŒ…

  å®‰è£…å®‰å…¨è½¯ä»¶ã€‚

  - è‡ªå¸¦ARPé˜²å¾¡åŠŸèƒ½ï¼šè…¾è®¯ç”µè„‘ç®¡å®¶ã€360å®‰å…¨å«å£«......

  - ä¸“ä¸šçš„ARPé˜²ç«å¢™ï¼šå½©å½±ARPã€é‡‘å±±è´å£³ã€360APRé˜²ç«å¢™......

  - ARPåŒå‘ç»‘å®šï¼šåœ¨Windows Terminalä¸­è¾“å…¥`arp -s <ip_address> <MAC_address>`ï¼Œæ‰‹åŠ¨æ·»åŠ é™æ€ARPè¡¨ï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°è¿™æ¡ARPè®°å½•çš„`Type`ä¸º`Static`

    ```
    C:\>arp -a
    
    Interface: 192.168.134.130 --- 0x2
      Internet Address      Physical Address      Type
      192.168.134.125       00-50-56-f4-03-54     dynamic
      192.168.134.2         00-50-56-f4-03-54     static
    ```

- ä¿è¯PCæ”¶åˆ°åä¸ç›¸ä¿¡ARPæ¬ºéª—åŒ…

  DAI(Dynamic ARP Inspection)ï¼Œå³åŠ¨æ€ARPæ£€æµ‹ã€‚Switchè®°å½•æ¯ä¸ªæ¥å£å¯¹åº”çš„IPåœ°å€å’ŒMACåœ°å€ï¼Œç”Ÿæˆé”®å¯¹`port<->MAC<->IP`ï¼Œä¿å­˜åœ¨DAIæ£€æµ‹è¡¨ä¸­ã€‚ç„¶åæ£€æµ‹æ¯ä¸ªæ¥å£å‘é€çš„`ARP Response`ï¼Œæ ¹æ®DAIè¡¨åˆ¤æ–­æ˜¯å¦è¿è§„ã€‚

  - è‹¥æ£€æµ‹åˆ°æœ‰ç«¯å£å‘é€çš„`ARP Response`ä¸DAIè¡¨ä¸ç¬¦ï¼Œåˆ™ä¸¢å¼ƒæ­¤åŒ…å¹¶å¯¹æ¥å£è¿›è¡Œæƒ©ç½š
  - è‹¥æ£€æµ‹åˆ°åŒä¸€ç«¯å£æœ‰å¤§é‡`ARP Request`åˆ™å…ˆä¸‹æ‰‹ä¸ºå¼ºï¼Œç›´æ¥è¿›è¡Œæƒ©ç½š

## Â§3.2 DDOSæ”»å‡»

DDOS(Distributed Denial of Service Attack)ï¼Œåˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»ã€‚

<div id="tab_1">
    <iframe src="http://www.digitalattackmap.com"
            height="500"
            width="1200"
            frameborder="0"
            scrolling="0"
            scale="80%"
    ></iframe>
</div>

<center>http://www.digitalattackmap.com å…¨çƒDDOSå®æ—¶åœ°å›¾</center>

### Â§3.2.1 ICMPæ³›æ´ªæ”»å‡»ï¼ˆæ­»äº¡ä¹‹pingï¼‰

äº’è”ç½‘ä¿¡æ¯æ§åˆ¶åè®®ï¼ˆInternet Control Message Protocolï¼‰ï¼Œç”¨äºå®ç°é“¾è·¯è¿é€šæ€§æµ‹è¯•å’Œé“¾è·¯è¿½è¸ªï¼Œé€šå¸¸è¢«`ping`å’Œ`tracert`å‘½ä»¤å‘é€ï¼Œåˆ†ä¸º`request`å’Œ`response`ä¸¤ç§åŒ…ã€‚

```mermaid
graph TB
	Y(PC_hacker)-->A
	Y(PC_hacker)-->B
	Y(PC_hacker)-->C
	Y(PC_hacker)-->D
	Y(PC_hacker)-->E
	Y(PC_hacker)-->F
	A(PC_botnet 1)-->Z(server)
	B(PC_botnet 2)-->Z(server)
	C(PC_botnet 3)-->Z(server)
	D(......)-->Z(server)
	E(PC_botnet n-1)-->Z(server)
	F(PC_botnet n)-->Z(server)
```

### Â§3.2.2 TCP/UDPæ³›æ´ªæ”»å‡»

```wireshark
Frame 615: 150 bytes on wire (1200 bits), 150 bytes captured (1200 bits) on interface \Device\NPF_{12A3CCD9-9882-4564-A320-FD3322961DDC}, id 0
Ethernet II, Src: 5e:55:cc:cb:14:fd (5e:55:cc:cb:14:fd), Dst: 62:f7:25:68:b5:84 (62:f7:25:68:b5:84)
Internet Protocol Version 4, Src: 192.168.42.247, Dst: 39.156.69.79
Transmission Control Protocol, Src Port: 64195, Dst Port: 80, Seq: 4833, Ack: 1, Len: 96
    Source Port: 64195
    Destination Port: 80
    [Stream index: 29]
    [TCP Segment Len: 96]
    Sequence number: 4833    (relative sequence number)
    Sequence number (raw): 3704167762
    [Next sequence number: 4929    (relative sequence number)]
    Acknowledgment number: 1    (relative ack number)
    Acknowledgment number (raw): 3286856445
    0101 .... = Header Length: 20 bytes (5)
    Flags: 0x018 (PSH, ACK)
    Window size value: 515
    [Calculated window size: 131840]
    [Window size scaling factor: 256]
    Checksum: 0x181e [unverified]
    [Checksum Status: Unverified]
    Urgent pointer: 0
    [SEQ/ACK analysis]
    [Timestamps]
    TCP payload (96 bytes)
    TCP segment data (96 bytes)
```

### Â§3.2.3 HTTPæ³›æ´ªæ”»å‡»

httpåŒ…çš„ä½“ç§¯è¿œå¤§äºtcpå’Œudpï¼Œå‘æœåŠ¡å™¨å‘é€å¤§é‡ä¸‹è½½ï¼Œç„¶åæ‹’ç»ä¸‹è½½æˆ–ä¸‹è½½ä¸€ç‚¹åæ–­å¼€è¿æ¥ï¼Œæ”»å‡»æ•ˆæœæ›´å¥½ã€‚

### Â§3.2.4 DNSæ”¾å¤§æ”»å‡»

### Â§3.2.5 å¸¸ç”¨å·¥å…·

#### Â§3.2.5.1 LOICï¼ˆLow Orbit Ion Cannonï¼Œä½è½¨é“ç¦»å­ç‚®ï¼‰

![LOICç•Œé¢](ç½‘ç»œå®‰å…¨/image-20210706182147907.png)

- Portï¼šç«¯å£
- Methodï¼šé€‰æ‹©TCP/UDP/HTMLæ³›æ´ªæ”»å‡»
- Threadsï¼šçº¿ç¨‹æ•°

#### Â§3.2.5.2 Nping

#### Â§3.2.5.3 Hping3

```shell
root@localhost# hping3 -c 100 -d 120 -S -w 64 -p 80 --flood --rand-source baidu.com
//
-c å‘é€æ•°æ®åŒ…ä¸ªæ•°
-d æ¯ä¸ªæ•°æ®åŒ…çš„å¤§å°
-S å‘é€SYNæ•°æ®åŒ…
-w TCP windowå¤§å°
-p æŒ‡å®šç«¯å£
--flood å°½å¯èƒ½å¿«åœ°å‘é€æ•°æ®åŒ…
--rand-source ä½¿ç”¨éšæœºIPåœ°å€
-aæˆ–-spoof éšè—ä¸»æœºå
```

## Â§3.3 MACæ”»é˜²

## Â§3.4 IPæ”»é˜²

# Â§4 Kaliæ¸—é€

æ¸—é€æµ‹è¯•ï¼ˆPen Testï¼‰ï¼šæ¨¡æ‹Ÿé»‘å®¢è¡Œä¸ºå¯¹ç›®æ ‡ç³»ç»Ÿå‘èµ·æ”»å‡»ï¼Œæ ¹æ®æ”»å‡»ç»“æœå¾—åˆ°å®‰å…¨è¯„ä¼°æŠ¥å‘Šã€‚

æ¸—é€åŸç†ï¼š

- æ¸—é€å‰æœŸï¼ˆç½‘ç»œè¸©ç‚¹ã€ç½‘ç»œæ‰«æã€ç½‘ç»œæŸ¥ç‚¹ï¼‰
  $$
  \begin{cases}
  	
  	å±€åŸŸç½‘æ‰«æ\begin{cases}
  		\text{arp-scan} \\
  		\text{nbtscan}
  	\end{cases}\\
  	
  	ç«¯å£æ‰«æ\begin{cases}
  		\text{nmap}\\
  	\end{cases}\\
  	
  	æ¼æ´æ‰«æ\begin{cases}
  		\text{openvas}\\
  		\text{nessus}
  	\end{cases}
  	
  \end{cases}
  $$

- æ¸—é€ä¸­æœŸï¼ˆåˆ©ç”¨æ¼æ´ä¿¡æ¯è¿›è¡Œæ¸—é€æ”»å‡»ã€è·å–æƒé™ ï¼‰

- æ¸—é€åæœŸï¼ˆåæ¸—é€ç»´æŒæ”»å‡»ã€æ–‡ä»¶æ‹·è´ã€æœ¨é©¬æ¤å…¥ã€ç—•è¿¹æ“¦é™¤ï¼‰

## Â§4.1 ç¯å¢ƒæ­å»º

```mermaid
graph LR
	A(æ”»å‡»æœº Linux Kali<br>192.168.134.129)-->B(é¶æœº Windows XP<br>192.168.134.130)
	C(æ”»å‡»æœº Windows Server 2021<br>192.168.134.132)-->B
	A-->D((é»˜è®¤ç½‘å…³<br>192.168.134.2))
	B-->D
	C-->D
	D-->F(Internet)
	E(Vmware DHCP/NAT Service<br>192.168.134.1)-->D
```

## Â§4.2 æ¸—é€å‰æœŸ

### Â§4.2.1 nbtscanï¼ˆä»…Windowsï¼‰

```shell
root@kali# nbtscan 192.168.134.0/24
Doing NBT name scan for addresses from 192.168.134.0/24

IP address       NetBIOS Name     Server    User             MAC address      
------------------------------------------------------------------------------
192.168.134.0   Sendto failed: Permission denied
192.168.134.130  017988B2FAA046E  <server>  <unknown>        00:0c:29:31:85:71
192.168.134.132  WIN-8LUUD97LMJC  <server>  <unknown>        00:0c:29:e2:78:3b
192.168.134.1    DESKTOP-0RKINDJ  <server>  <unknown>        00:50:56:c0:00:08
```

æˆåŠŸæ‰«æå‡ºé¶æœº192.168.134.130å’Œå¦ä¸€å°æ”»å‡»æœº192.168.134.132

### Â§4.2.2 arp-scan

```shell
root@kali# ifconfig
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.134.129  netmask 255.255.255.0  broadcast 192.168.134.255
        inet6 fe80::20c:29ff:fe3d:e7e0  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:3d:e7:e0  txqueuelen 1000  (Ethernet)
        RX packets 2762  bytes 225820 (220.5 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 895  bytes 62709 (61.2 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
// æˆåŠŸæ‰¾åˆ°ç½‘å¡åç§°eth0

// --interface=<ç½‘å¡åç§°>
root@kali# arp-scan --interface=eth0 192.168.134.0/24
Interface: eth0, type: EN10MB, MAC: 00:0c:29:3d:e7:e0, IPv4: 192.168.134.129
Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.134.1   00:50:56:c0:00:08       VMware, Inc.
192.168.134.2   00:50:56:f4:03:54       VMware, Inc.
192.168.134.130 00:0c:29:31:85:71       VMware, Inc.
192.168.134.132 00:0c:29:e2:78:3b       VMware, Inc.
192.168.134.254 00:50:56:e5:11:f0       VMware, Inc.

5 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.9.7: 256 hosts scanned in 2.236 seconds (114.49 hosts/sec). 5 responded
```

### Â§4.2.3 nmap

å®‰å…¨æ¸—é€é¢†åŸŸæœ€å¼ºå¤§çš„å¼€æºç«¯å£æ‰«æå™¨ï¼Œèƒ½æ”¯æŒè·¨å¹³å°è¿è¡Œã€‚
$$
\begin{cases}
	ä¸»æœºå‘ç°&\text{nmap -sn <ipåœ°å€æ®µ>}&\text{æ‰«æMACã€IPï¼Œä¸åšç«¯å£æ‰«æï¼ŒèŠ‚çœæ—¶é—´}\\
	ç«¯å£æ‰«æ&\text{nmap -sS -p1-1000 <ipåœ°å€æ®µ>}&\text{}\\
	ç³»ç»Ÿæ‰«æ&\text{namp -O <ipåœ°å€>}&\text{æ“ä½œç³»ç»Ÿã€IPã€MACã€ç«¯å£ã€æœåŠ¡}\\
	ç‰ˆæœ¬æ‰«æ&\text{nmap -sV <ipåœ°å€>}&\text{æ“ä½œç³»ç»Ÿã€IPã€MACã€ç«¯å£ã€æœåŠ¡ã€è½¯ä»¶ç‰ˆæœ¬}\\
	ç»¼åˆæ‰«æ&\text{nmap -A <ipåœ°å€>}&\text{æ‰€æœ‰ä¿¡æ¯}\\
\end{cases}
$$

```shell
â”Œâ”€â”€(rootğŸ’€kali)-[/home/kali]
â””â”€# nmap -A 192.168.134.130                                                 130 â¨¯
Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-06 07:52 EDT
Nmap scan report for 192.168.134.130
Host is up (0.00042s latency).
Not shown: 997 closed ports
PORT    STATE SERVICE      VERSION
135/tcp open  msrpc        Microsoft Windows RPC
139/tcp open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds Windows XP microsoft-ds
MAC Address: 00:0C:29:31:85:71 (VMware)
Device type: general purpose
Running: Microsoft Windows XP
OS CPE: cpe:/o:microsoft:windows_xp::sp2 cpe:/o:microsoft:windows_xp::sp3
OS details: Microsoft Windows XP SP2 or SP3
Network Distance: 1 hop
Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp

Host script results:
|_clock-skew: mean: -4h00m07s, deviation: 5h39m24s, median: -8h00m07s
|_nbstat: NetBIOS name: 017988B2FAA046E, NetBIOS user: <unknown>, NetBIOS MAC: 00:0c:29:31:85:71 (VMware)
| smb-os-discovery: 
|   OS: Windows XP (Windows 2000 LAN Manager)
|   OS CPE: cpe:/o:microsoft:windows_xp::-
|   Computer name: 017988b2faa046e
|   NetBIOS computer name: 017988B2FAA046E\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2021-07-06T19:52:23+08:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_smb2-time: Protocol negotiation failed (SMB2)

TRACEROUTE
HOP RTT     ADDRESS
1   0.42 ms 192.168.134.130

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 58.85 seconds
```

## Â§4.3 æ¸—é€ä¸­æœŸ

### Â§4.3.1 MS12-020

> MS12-010ï¼šä»£å·æŒ‡â€Microsoft 2012 ç¬¬20ä¸ªæ¼æ´â€œï¼Œå¼€å¯è¿œç¨‹æ¡Œé¢æœåŠ¡ï¼ˆ3389ç«¯å£ï¼‰çš„ç³»ç»Ÿå¯è¢«æ‰§è¡Œè¿œç¨‹ä»£ç ï¼ˆè“å±é‡å¯ï¼‰ï¼Œå½±å“èŒƒå›´ä¸ºWindows XPã€Windows 7ã€Windows Server 2003/2008
>
> å¾®è½¯æ–‡æ¡£ï¼š[Microsoft å®‰å…¨å…¬å‘Š MS12-020 - ä¸¥é‡](https://docs.microsoft.com/zh-cn/security-updates/Securitybulletins/2012/ms12-020)
>
> Githubå­˜æ¡£ï¼š[SecWiki/windows-kernel-exploits/MS12-020](https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS12-020)

Exploit/POCï¼šæ¸—é€æµ‹è¯•ä»£ç ï¼Œæ ¹æ®å­˜åœ¨çš„æ¼æ´ï¼Œç¼–å†™æ”»å‡»ä»£ç ã€‚

### Â§4.3.2 MS08-067ï¼ˆæ°¸æ’ä¹‹è“ï¼‰

> MS08-067
>
> å¾®è½¯æ–‡æ¡£ï¼š[Microsoft å®‰å…¨å…¬å‘Š MS08-067 - ä¸¥é‡](https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2008/ms08-067)

#
